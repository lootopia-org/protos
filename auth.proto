syntax = "proto3";

package authentication;

service AuthenticationService {
    rpc Register(RegisterRequest) returns (RegisterResponse);
    rpc Login(LoginRequest) returns (LoginResponse);
    rpc Logout() returns (LogoutResponse);
    rpc RefreshToken() returns (RefreshTokenResponse);
    rpc VerifyToken() returns (VerifyTokenResponse);
    
    rpc UpdateUserEmail(UpdateUserEmailRequest) returns (UpdateUserEmailResponse);
    rpc ChangePassword(ChangePasswordRequest) returns (ChangePasswordResponse);
    rpc DeleteUser() returns (DeleteUserResponse);
    
    rpc SendEmailVerification(SendEmailVerificationRequest) returns (SendEmailVerificationResponse);
    rpc VerifyEmail(VerifyEmailRequest) returns (VerifyEmailResponse);
    
    rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);
  
    
    rpc AssignRole(AssignRoleRequest) returns (AssignRoleResponse);
    rpc RemoveRole(RemoveRoleRequest) returns (RemoveRoleResponse);
    rpc GetUserRoles() returns (GetUserRolesResponse);
    
    rpc GetAuthFactors(GetAuthFactorsRequest) returns (GetAuthFactorsResponse);
    rpc UpdateAuthFactors(UpdateAuthFactorsRequest) returns (UpdateAuthFactorsResponse);
}

message AuthTokens {
    string access_token = 1;
    string refresh_token = 2;
    string mfa_session_token = 3;
    int64 expires_in = 4;
}

message RegisterRequest {
    string email = 1;
    string password = 2;
}

message RegisterResponse {
    bool success = 1;
    string message = 2;
}

message LoginRequest {
    string email = 1;
    string password = 2;
    optional string totp_code = 3;
    optional string email_otp_code = 4;
}

message LoginResponse {
    bool success = 1;
    string message = 2;
    AuthTokens tokens = 3;
}


message LogoutResponse {
    bool success = 1;
    string message = 2;
}


message RefreshTokenResponse {
    bool success = 1;
    string message = 2;
    AuthTokens tokens = 3;
}


message VerifyTokenResponse {
    bool valid = 1;
    string message = 2;
}

message UpdateUserEmailRequest {
    string new_email = 1;
  }

message UpdateUserEmailResponse {
    bool success = 1;
    string message = 2;
}

message ChangePasswordRequest {
    string current_password = 1;
    string new_password = 2;
}

message ChangePasswordResponse {
    bool success = 1;
    string message = 2;
}


message DeleteUserResponse {
    bool success = 1;
    string message = 2;
}

message SendEmailVerificationRequest {
    string lang = 1;
}

message SendEmailVerificationResponse {
    bool success = 1;
    string message = 2;
}

message VerifyEmailRequest {
    string otp_code = 2;
}

message VerifyEmailResponse {
    bool success = 1;
    string message = 2;
}

message ResetPasswordRequest {
    string otp_code = 1;
    string new_password = 2;
}

message ResetPasswordResponse {
    bool success = 1;
    string message = 2;
}


message AssignRoleRequest {
    string role_name = 1;
}

message AssignRoleResponse {
    bool success = 1;
    string message = 2;
}

message RemoveRoleRequest {
    string role_name = 1;
}

message RemoveRoleResponse {
    bool success = 1;
    string message = 2;
}


message GetUserRolesResponse {
    bool success = 1;
    string message = 2;
    repeated string roles = 3;
}

message GetAuthFactorsRequest {}

message GetAuthFactorsResponse {
    bool success = 1;
    string message = 2;
    string primary_factor = 3;
    string secondary_factor = 4;
}

message UpdateAuthFactorsRequest {
    string primary_factor = 1;
    string secondary_factor = 2;
    string lang = 3;
}

message UpdateAuthFactorsResponse {
    bool success = 1;
    string message = 2;
    string primary_factor = 3;
    string secondary_factor = 4;
    string totp_secret = 5;
    string totp_qr_url = 6;
}

